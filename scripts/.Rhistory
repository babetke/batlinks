## dummy h-v association edgelist
tmp=data.frame(host=c("a","a","b","c","b","d"),
virus=c("v1","v2","v3","v1","v4","v1"))
## unique
tmp$link=paste0(tmp$host,"-",tmp$virus)
tmp$association=1
## expand grid
all=expand.grid(host=unique(tmp$host),
virus=unique(tmp$virus))
## unique
all$link=paste0(all$host,"-",all$virus)
## merge
test=merge(all,tmp[c("link","association")],by="link",all.x=T)
## if NA, pseudoabsence
test$known=ifelse(is.na(test$association),0,test$association)
View(test)
## clean environment & plots
rm(list=ls())
graphics.off()
## packages
library(tidyverse)
library(vroom)
library(ape)
## load VIRION
# V8 of virion
virion <- vroom(file = "/Users/brianabetke/outputs/15692263/virion.csv.gz")
# update host names to capitalize to be consistent with PREDICT names
virion$Host <- Hmisc::capitalize(virion$Host)
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
View(bats)
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
View(bats)
View(bats)
View(virion)
View(bats)
# Unique associations
bats <- bats %>% mutate(unique = paste(Host,Virus)) %>% filter(!duplicated(unique))
View(bats)
?paste()
# Unique associations
bats <- bats %>% mutate(unique = paste(Host,Virus, collapse = "-")) %>% filter(!duplicated(unique))
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(unique = paste(Host,Virus, collapse = "-")) %>% filter(!duplicated(unique))
View(bats)
## load VIRION
# V8 of virion
virion <- vroom(file = "/Users/brianabetke/outputs/15692263/virion.csv.gz")
# update host names to capitalize to be consistent with PREDICT names
virion$Host <- Hmisc::capitalize(virion$Host)
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(unique = paste(Host,Virus, collapse = "-")) %>% filter(!duplicated(unique))
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
bats %>% mutate(unique = paste(Host,Virus,collapse = "-"))
#
test <- bats %>% mutate(unique = paste(Host,Virus,collapse = "-"))
View(test)
View(test)
View(test)
## clean environment & plots
rm(list=ls())
graphics.off()
## packages
library(tidyverse)
library(vroom)
library(ape)
## load VIRION
# V8 of virion
virion <- vroom(file = "/Users/brianabetke/outputs/15692263/virion.csv.gz")
# update host names to capitalize to be consistent with PREDICT names
virion$Host <- Hmisc::capitalize(virion$Host)
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(unique = paste(Host,Virus,collapse = "-")) %>% filter(!duplicated(unique))
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(unique = paste0(Host,Virus,collapse = "-")) %>% filter(!duplicated(unique))
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(unique = paste0(Host,Virus,sep = "-")) %>% filter(!duplicated(unique))
View(bats)
bats$unique
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(unique = paste(Host,Virus,sep = "-")) %>% filter(!duplicated(unique))
View(bats)
View(virion)
View(bats)
## dummy h-v association edgelist
tmp=data.frame(host=c("a","a","b","c","b","d"),
virus=c("v1","v2","v3","v1","v4","v1"))
## unique
tmp$link=paste0(tmp$host,"-",tmp$virus)
tmp$association=1
## expand grid
all=expand.grid(host=unique(tmp$host),
virus=unique(tmp$virus))
## unique
all$link=paste0(all$host,"-",all$virus)
## merge
test=merge(all,tmp[c("link","association")],by="link",all.x=T)
## if NA, pseudoabsence
test$known=ifelse(is.na(test$association),0,test$association)
View(test)
View(bats)
# associations only
bats %>% select(unique, Host, Virus, VirusFamily)
View(test)
# family associations
bats %>% select(unique, Host, Virus, VirusFamily) %>% mutate(fam_links = paste(Host,VirusFamily))
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(sp_links = paste(Host,Virus,sep = "-")) %>% filter(!duplicated(sp_links))
# associations only
bats <- bats %>% select(sp_links, Host, Virus, VirusFamily)
View(bats)
humans <-
# label as 1 if in common with bats
# family associations
bats <- bats %>% select(sp_links, Host, Virus, VirusFamily) %>% mutate(fam_links = paste(Host,VirusFamily, sep="-"))
View(humans)
# should we mark zoonotic associations?
# pull human viruses
humans <- virion %>% filter(Host == "Homo sapiens")
humans <- humans %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
humans <- humans %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
humans <- humans %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
View(bats)
## load VIRION
# V8 of virion
virion <- vroom(file = "/Users/brianabetke/outputs/15692263/virion.csv.gz")
# update host names to capitalize to be consistent with PREDICT names
virion$Host <- Hmisc::capitalize(virion$Host)
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(sp_links = paste(Host,Virus,sep = "-")) %>% filter(!duplicated(sp_links))
# associations only
bats <- bats %>% select(sp_links, Host, Virus, VirusFamily)
# should we mark zoonotic associations?
# pull human viruses
humans <- virion %>% filter(Host == "Homo sapiens")
humans <- humans %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
humans <- humans %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
humans <- humans %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
View(humans)
hvir <- humans$Virus
unique(hvir)
hvir <- unique(humans$Virus)
View(bats)
# label as 1 if in common with bats
bats %>% mutate(zoo_sp = ifelse(Virus %in% hvir,1,0))
# label as 1 if in common with bats
bats <- bats %>% mutate(zoo_sp = ifelse(Virus %in% hvir,1,0))
View(bats)
# family associations
bats <- bats %>% select(sp_links, Host, Virus, VirusFamily) %>% mutate(fam_links = paste(Host,VirusFamily, sep="-"))
View(bats)
# Pull all chiroptera, including PREDICT which is capitalized
bats <- virion %>% filter(HostOrder == "chiroptera"| HostOrder =="Chiroptera")
# NCBI ratified hosts and viruses
bats <- bats %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
# clear out NAs for host, virus, and virus family
bats <- bats %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
# trim to PCR and iso detections only
bats <- bats %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
# Unique associations
bats <- bats %>% mutate(sp_links = paste(Host,Virus,sep = "-")) %>% filter(!duplicated(sp_links))
# associations only
bats <- bats %>% select(sp_links, Host, Virus, VirusFamily)
# should we mark zoonotic associations?
# pull human viruses
humans <- virion %>% filter(Host == "Homo sapiens")
humans <- humans %>% filter(HostNCBIResolved==T & VirusNCBIResolved==T)
humans <- humans %>% drop_na(Host, Virus) %>% filter(!is.na(VirusFamily))
humans <- humans %>% filter(DetectionMethod == "PCR/Sequencing" | DetectionMethod == "Isolation/Observation")
hvir <- unique(humans$Virus)
# label as 1 if in common with bats
bats <- bats %>% mutate(zoonotic = ifelse(Virus %in% hvir,1,0))
# family associations
bats <- bats %>% select(sp_links, Host, Virus, VirusFamily, zoonotic) %>% mutate(fam_links = paste(Host,VirusFamily, sep="-"))
View(bats)
# look at unique
fams <- bats %>% filter(!duplicated(fam_links))
View(fams)
View(bats)
View(fams)
table(bats$zoonotic)
table(fams$zoonotic)
# look at unique
fams <- bats %>% filter(!duplicated(fam_links)) %>% select(sp_links, Host, Virus, VirusFamily)
View(fams)
# look at unique
fams <- bats %>% filter(!duplicated(fam_links)) %>% select(fam_links, sp_links, Host, Virus, VirusFamily)
View(fams)
# look at unique
fams <- bats %>% filter(!duplicated(fam_links)) %>% select(fam_links, Host, VirusFamily)
View(fams)
bats %>% group(host, VirusFamily) %>% summarize(zvirus = sum(zoonotic))
bats %>% group_by(host, VirusFamily) %>% summarize(zvirus = sum(zoonotic))
bats %>% group_by(Host, VirusFamily) %>% summarize(zvirus = sum(zoonotic))
bats %>% group_by(Host, VirusFamily) %>% summarize(zvirus = sum(zoonotic)) -> eek
View(eek)
View(bats)
View(fams)
View(bats)
View(tmp)
View(all)
View(bats)
View(eek)
View(fams)
View(humans)
View(eek)
View(bats)
View(eek)
# merge aggregated to fams
merge(fams, eek, by="species")
# merge aggregated to fams
merge(fams, eek, by="Host")
# merge aggregated to fams
merge(fams, eek[c("Host","zvirus")], by="Host")
View(fams)
getwd()
write.csv(bats, "/Users/brianabetke/Desktop/batlinks/batlinks/bat-virus species associations.csv")
write.csv(bats, "/Users/brianabetke/Desktop/batlinks/batlinks/bat-virus species associations.csv", row.names = FALSE)
write.csv(fams, "/Users/brianabetke/Desktop/batlinks/batlinks/bat-virus family associations.csv", row.names = FALSE)
write.csv(bats, "/Users/brianabetke/Desktop/batlinks/batlinks/virus associations/bat-virus species associations.csv", row.names = FALSE)
write.csv(fams, "/Users/brianabetke/Desktop/batlinks/batlinks/virus associations/bat-virus family associations.csv", row.names = FALSE)
write.csv(bats, "/Users/brianabetke/Desktop/batlinks/batlinks/virus association data/bat-virus species associations.csv", row.names = FALSE)
write.csv(fams, "/Users/brianabetke/Desktop/batlinks/batlinks/virus associations data/bat-virus family associations.csv", row.names = FALSE)
write.csv(fams, "/Users/brianabetke/Desktop/batlinks/batlinks/virus association data/bat-virus family associations.csv", row.names = FALSE)
